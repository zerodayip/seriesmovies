name: Get Final Redirect HTML (Playwright)

on:
  workflow_dispatch:

jobs:
  scrape:
    runs-on: ubuntu-latest

    steps:
      - name: Kod deposunu çek
        uses: actions/checkout@v4

      - name: Node kurulumu
        uses: actions/setup-node@v4
        with:
          node-version: '18'

      - name: Playwright kurulumu
        run: |
          npm init -y
          npm install playwright
          npx playwright install

      - name: Playwright ile gerçek sayfayı çek
        run: |
          node << 'EOF'
          const { chromium } = require("playwright");

          (async () => {
            const TARGET_URL = "https://sezonlukdizi8.com/link.asp?id=";

            console.log("15 saniye bekleniyor, istek yapmadan...");
            await new Promise(resolve => setTimeout(resolve, 15000));

            const browser = await chromium.launch({ headless: true });
            const page = await browser.newPage();

            console.log("Sayfaya gidiliyor:", TARGET_URL);

            await page.goto(TARGET_URL, {
              waitUntil: "networkidle",
              timeout: 120000
            });

            const finalUrl = page.url();
            console.log("Son yönlendirme URL:", finalUrl);

            const html = await page.content();
            console.log("------- HTML BAŞLANGICI -------");
            console.log(html);
            console.log("------- HTML BİTİŞİ -------");

            await browser.close();
          })();
          EOF
